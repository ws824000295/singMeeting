 $(function() {	var pageNum=0;	$("#mb_menu li a").click(function() {		var oA = $(this);		var index = oA.parent().index();		var h = $(".item").eq(index).offset().top + 'px';		if(oA.attr("class") != "current") {			$('html,body').animate({				scrollTop: h			}, 300);		}		if($(this).parent("li").index()==0){			$("#mb_menu").css("display","none")		}	});		 //到后台那数据，浏览量，领取量，领取人头像	 getfuliMsg();	 getfuliListMsg();	 pinglunlist(pageNum); 	 fuliHeight = fuliHeight.replace(",","")	 if(modelType == 0){		//老版		 	 var item2Th = 0;			 var item2Hh = 0;			 var maxI = 0;			 var len = $('.phone_msg').children().length;			 for(var i =0 ; i< len ; i++){			 	var thisTop = parseInt($('.phone_msg').children().eq(i).css("top"));			 	if(thisTop > item2Th){			 		maxI = i;			 		item2Th = thisTop;			 	}			 }			item2Hh = parseInt($('.phone_msg').children().eq(maxI).css("height"));			if(item2Th + item2Hh < 486){				$("#item2").css("height", "486px");				$(".phone_msg").css("height", "486px");			}else{				$("#item2").css("height", item2Th + item2Hh + 'px');				$(".phone_msg").css("height", item2Th + item2Hh + 'px');			}	 }else if(modelType == 2){	//张凯恒模板	 		$("#item2").css("height", fuliHeight+ 'px');			$(".phone_msg").css("height", fuliHeight + 'px');	 }else{						// 百度	 		$(".phone_msg").css("position","inherit");	 }		var mySwiper = new Swiper ('.mb2_peoples .swiper-container', {	    slidesPerView : 7,	    spaceBetween : 5,	    loop:true,	    observer:true,		observeParents:false,	    autoplay : 2000  	});	//判断是否是限时抢购福利	if(limitRob!=0){		$('.time').hide();	}	findUserWelfareType();		$("#lianjieyaoqing").unbind('click').bind('click',function(){ $("#fl_xiangqingbak").css("display","block"); });		$("#zhidaole").unbind('click').bind('click',function(){ $("#fl_xiangqingbak").css("display","none"); });		//禁止蒙层下面内容滚动	var obj = document.getElementsByClassName('welfare_kuangBlack')[0];	obj.addEventListener('touchmove', function(event) {    		event.preventDefault(); // 阻止浏览器默认事件，重要 	}, false); 	//禁止蒙层下面内容滚动	var obj = document.getElementsByClassName('welfare_kuang')[0];	obj.addEventListener('touchmove', function(event) {    		event.preventDefault(); // 阻止浏览器默认事件，重要 	}, false); });//福利详情添加喜欢 function attentionWelfare(){ 	$.ajax({ 		url:ctx + "/manage/web/attentionWelfare", 		async: false, 		data:{"welfareId":welfareId,"userId":user.id,"adminId":user.adminId}, 		success:function(data){ 			 			if(data.satue=="have"){ 		 				$('.mb_heart').css('background-image', 'url('+ctx+'/images/fuli/heart_xuan.png)'); 			}else{ 				$('.mb_heart').css('background-image', 'url('+ctx+'/images/fuli/heart_wei.png)'); 			} 		} 	}) } //福利详情添加喜欢 function findUserWelfareType(){ 	$.ajax({ 		url:ctx + "/manage/web/findUserWelfareType", 		async: true, 		data:{"welfareId":welfareId,"userId":user.id,"adminId":user.adminId}, 		success:function(data){ 			if(data.satue=="have"){ 				$('.mb_heart').css('background-image', 'url('+ctx+'/images/fuli/heart_xuan.png)'); 			}else{ 				$('.mb_heart').css('background-image', 'url('+ctx+'/images/fuli/heart_wei.png)'); 			} 		} 	}) }//新人被分享福利的---直接成为下级function toSharedWelfare(){	if(user.userType == 0){//如果被分享人不是福星		$.ajax({			url: ctx +"/manage/shareRecords/welfareSharing",			data:{"shareId":shareUserId,"clickId":user.id},			async: false,			success:function(data){				if(data.status=='SUCCESS'){					sessionStorage.removeItem("loginuser");					sessionStorage.setItem("loginuser",JSON.stringify(data.user));				}			}		});	}}	//到后台那数据：浏览量，领取量，领取人头像function getfuliMsg(){	$.ajax({		url: ctx +"/manage/web/getfuliMsg",		data:{"welfareId":welfareId,"adminId":user.adminId},		success:function(data){			if(data!=null){				$("#companyInfoLogo").attr("src",imgctx + data.companyInfo.companyLogo);				$("#companyInfoname").html(data.companyInfo.companyName);				$("#zhuanfa").html(data.num);																$("#liulan").html(data.welfare.viewCount);						//浏览				//转发				 if(data.welfare.billingType =='5'){					$("#lingqu").html("购买"+(data.welfare.welfareVirtualNum+data.welfare.receiveNum));  //领取					$("#zongliang").html("已购买"+(data.welfare.welfareVirtualNum+data.welfare.receiveNum)+"份/限"+(data.welfare.welfareVirtualNum+data.welfare.welfareNumCopy)+"份");				} else if(data.welfare.billingType =='1'){					$("#lingqu").html("报名"+(data.welfare.welfareVirtualNum+data.welfare.receiveNum));  //领取					$("#zongliang").html("已报名"+(data.welfare.welfareVirtualNum+data.welfare.receiveNum)+"人/限"+(data.welfare.welfareVirtualNum+data.welfare.welfareNumCopy)+"人");				}else if(data.welfare.billingType =='2'){					$("#lingqu").html("点击"+(data.welfare.welfareVirtualNum+data.welfare.receiveNum));  //领取					$("#zongliang").html("已点击"+(data.welfare.welfareVirtualNum+data.welfare.receiveNum)+"人/限"+(data.welfare.welfareVirtualNum+data.welfare.welfareNumCopy)+"人");				}else if(data.welfare.billingType =='3'){					$("#lingqu").html("浏览"+(data.welfare.welfareVirtualNum+data.welfare.receiveNum));  //领取					$("#zongliang").html("已浏览"+(data.welfare.welfareVirtualNum+data.welfare.receiveNum)+"人/限"+(data.welfare.welfareVirtualNum+data.welfare.welfareNumCopy)+"人");				}else if(data.welfare.billingType =='4'){					$("#lingqu").html("领取"+(data.welfare.welfareVirtualNum+data.welfare.receiveNum));  //领取					$("#zongliang").html("已领取"+(data.welfare.welfareVirtualNum+data.welfare.receiveNum)+"人/限"+(data.welfare.welfareVirtualNum+data.welfare.welfareNumCopy)+"人");				}else if(data.welfare.billingType =='6'){					$("#lingqu").html("领取"+(data.welfare.welfareVirtualNum+data.welfare.receiveNum));  //领取					$("#zongliang").html("已领取"+(data.welfare.welfareVirtualNum+data.welfare.receiveNum)+"人/限"+(data.welfare.welfareVirtualNum+data.welfare.welfareNumCopy)+"人");				}				 if(modelStyle=='0'){					 $("#canjia").html("已有"+(data.peopleNumber + data.welfare.welfareVirtualNum)+"人参加");				 }				 if(modelStyle=='1'){				 						 $("#canjia").html("<span class='bubaoyou-title'>已售出" + (data.welfare.receiveNum + data.welfare.welfareVirtualNum) + "件</span><p style='color: #fe3657;font-size: 10px;margin-left: 10px;'>剩余" + (data.welfare.welfareNum-data.welfare.receiveNum) + "件</p>");				 }				var htmll='';				for(var i=0;i<data.imgList.length;i++){					htmll+= '<li class="swiper-slide"><img src="'+data.imgList[i]+'" /></li>';				} 				if(parseInt((data.welfare.welfareVirtualNum+data.welfare.receiveNum)) >=7){					$("#touxiang2").append('<img class="go" src="'+ctx+'/images/fuli/go.png" />');				}				$("#touxiang").append(htmll);							}		}	}) }function menu(wrap, menuList, menuItems) {	var deviceWidth = $(window).width();	var positionX = 0;	var menuListPositionX1 = wrap.offset().left; 	var menuListPositionX2 = menuListPositionX1 + wrap.width();      	    	$(menuList).attr("style","transition-duration: 0ms;transform: translateX(0px);");	menuList.addEventListener('touchstart',function(event){		if(event.targetTouches.length == 1){	        var touch = event.targetTouches[0];	        positionX = touch.pageX;	        //确定本次拖动transform的初始值	        var transformStr = menuList.style.transform;	        transformStr = transformStr.substring(11);	        var index = transformStr.lastIndexOf("p");	        transformStr = transformStr.substring(0, index);	        transformX = parseInt(transformStr);	        //确定本次拖动的div宽度值	        var widthStr = menuList.style.width;	        thisWidth = parseInt(widthStr.substring(0,widthStr.lastIndexOf("p")));	    }	}, false);	menuList.addEventListener('touchmove', function(event) {	    //阻止其他事件	    event.preventDefault();	    //获取当前坐标	    if(event.targetTouches.length == 1){	        var touch = event.targetTouches[0];	        menuList.style.transform = 'translateX('+(transformX+touch.pageX-positionX)+'px)';	        $(menuList).css("width",thisWidth+positionX-touch.pageX);	    }	}, false);	menuList.addEventListener('touchend', function(event) {	    var menuItem1 = menuItems[0];	    var menuItem1Left = $(menuItem1).offset().left;	    console.log(menuItem1Left);	   	var menuItem2 = menuItems[menuItems.length-1];	    var menuItemPositionX = $(menuItem2).offset().left+$(menuItem2).width();	    var firstToLast = menuItemPositionX - menuItem1Left;	    if (menuItem1Left > menuListPositionX1 || firstToLast < deviceWidth) {	        menuList.style.transform = 'translateX('+(menuListPositionX1)+'px)';	    }	    if(menuItemPositionX < menuListPositionX2 && menuItem1Left < 0 && firstToLast > deviceWidth) {	    	var myWidth = $(menuList).width() - deviceWidth;	        menuList.style.transform = 'translateX('+(0-myWidth)+'px)';	    }	}, false);}function init() {	var menuWrap = $('#content');	var menuList = $(".mb_commoditylist.item")[0];	var menuListItems = $("#item3 li");	menu(menuWrap, menuList, menuListItems);}//下方热门推荐function getfuliListMsg(){	/*var res = "false";	if(user.adminId != welfareAdminId){		res = "true";	}	if(getQueryStr("companyType")!=""&&getQueryStr("companyType")=="1"){		var json = {"welfareId":welfareId,"adminId":user.adminId,"companyType":getQueryStr("companyType"),"companyTypeId":getQueryStr("companyTypeId"),"res":res};	}else{		var json = {"welfareId":welfareId,"adminId":user.adminId,"res":res};	}	console.log(user.adminId);*/	var json={"adminId":user.adminId};	$.ajax({		url: ctx +"/manage/web/getfuliListMsg",		data:json,		success:function(data){			var html = "";			var iregion;			for(var i =0;i<data.welfareList.length; i++){				html += "<li onclick='checkState(\""+data.welfareList[i].id+"\",\""+data.welfareList[i].detailTwoDimension+"\",\""+data.welfareList[i].shareLevel+"\")'>";				html += "<div class='thumb-box'>"				if(data.welfareList[i].welfareImg==""){					html +=	'<img />';				}else{					if(data.welfareList[i].phpId == "" || data.welfareList[i].phpId == null ){						html +=	'<img class="img" src="'+imgctx+data.welfareList[i].welfareImg+'" />';					}else{						html +=	'<img class="img" src="'+data.welfareList[i].welfareImg+'" />';					}				}				html +=	     '<i class="top"></i>';				html +=	     '<span class="bi">'+data.welfareList[i].welfareRewardCoin+'福钻</span>';				html += "</div>"				html +=	'<div class="msg">';				html +=		'<p class="title">'+data.welfareList[i].welfareName+'</p>';				html +=		'<p class="recommend-price"><span class="recommend-price-gray">￥'+data.welfareList[i].price+'</span><span class="recommend-price-red">￥'+data.welfareList[i].paymoney+'</span></p>';				html +=	'</div>';				html +='</li>';			}			$("#item3").append(html);			init();		}	});} //评论框显示  回复福利function comment(){	$("#pinglunMsg").val("");	$('#fuliComment').show();	}//发表function Submitcomment(){	var content = $("#pinglunMsg").val();	if(content!=null && content.length !=0){		$.ajax({			url: ctx +"/manage/web/saveComment",			data:{"welfareId":welfareId,"adminId":user.adminId,"userId":user.id,"content":content},			success:function(data){				if(data.result='yes'){					showtips($('#pinglunsuccess'));					$('#fuliComment').hide();					pinglunlist(0);				}			}		})	}else{		alert("请填写评论");	}}//评论框显示 回复用户function huifu(id){	sessionStorage.setItem("parentId",id);	$("#pinglunMsg2").val("");	$('#userComment').show();}//发表function SubmitcommentAndParent(){	var content2 = $("#pinglunMsg2").val();	var parentId = sessionStorage.getItem("parentId");	if(content2!=null && content2.length !=0){		$.ajax({			url: ctx +"/manage/web/saveComment",			data:{"welfareId":welfareId,"adminId":user.adminId,"userId":user.id,"content":content2,"parentId":parentId},			success:function(data){				if(data.result='yes'){					showtips($('#pinglunsuccess'));					$('#userComment').hide();					pinglunlist(0);				}			}		})	}else{		alert("请填写评论");	}}//加载评论function pinglunlist(obj){	$.ajax({		url: ctx +"/manage/web/pinglunlist",		data:{"welfareId":welfareId,"adminId":user.adminId,"pageNum":obj},		success:function(data){			if(data != null && data != ""){				if(data.num!=null && data.num!=''){					$("#commentNum").html("("+data.num+")");				}				var html='';				for(var i=0;i<data.commentRecordDtoList.length;i++){					html+= '<div class="mb_pinglunmsg">';					html+= '	<img class="img" src="'+data.commentRecordDtoList[i].userIconUrl+'" />';					html+= '	<div class="msg">';					html+= '		<div class="name">'+data.commentRecordDtoList[i].userName+'</div>';                    html+= '<span style="float: right;">'+FormatDate(data.commentRecordDtoList[i].createTime)+'</span>';					html+= '		<p><span class="time"></span></p>';					html+= '		<div class="msgall">'+data.commentRecordDtoList[i].content+'</div>';					html+= '	</div>';					html+= "	<p class='huifu' onclick='huifu(\""+data.commentRecordDtoList[i].id+"\")'>回复</p>";					html+= '</div>';					if(data.commentRecordDtoList[i].commentRecordList !=null){						for(var j=0;j<data.commentRecordDtoList[i].commentRecordList.length;j++){							html+= '<div class="mb_pinglunmsg mb_pinglun_two">';							if(data.commentRecordDtoList[i].commentRecordList[j].userName !='系统回复'){								html+= '	<img class="img" src="'+data.commentRecordDtoList[i].commentRecordList[j].userIconUrl+'" />';							}else{								html+= '	<img class="img" src="'+ctx+'/images/xuniicon.png" />';							}							html+= '	<div class="msg">';							html+= '		<div class="name">'+data.commentRecordDtoList[i].commentRecordList[j].userName+'</div>';                            html+= '<span style="float: right;margin-right: 7.5px;margin-top: 1px;">'+FormatDate(data.commentRecordDtoList[i].commentRecordList[j].createTime)+'</span>';							html+= '		<div class="msgall">回复&nbsp;<font color="f9624c">'+data.commentRecordDtoList[i].userName+'</font>：'+data.commentRecordDtoList[i].commentRecordList[j].content+'</div>';							html+= '	</div>';							if(data.commentRecordDtoList[i].commentRecordList[j].userName !='系统回复'){								html+= "	<p class='huifu' style='margin-top:1px;'  onclick='huifu(\""+data.commentRecordDtoList[i].id+"\")'>回复</p>";							}else{								html+= '	<p class=""></p>';							}							html+= '</div>';						}					}				}				if(data.num2>3){					$("#jiazai").remove();					$(".mb_pinglunlist").after("<p id='jiazai' style='text-align: center;color:#ccc' onclick='pinglunlist(\""+data.pageNum+"\")'>更多评论...</p>");				}				if(data.pageNum=='1'){					$(".mb_pinglunlist").empty();				}				$(".mb_pinglunlist").append(html);			}		}	})} /***分享之前查看当前人 是否为福星 0不是福星, 1是福星*/function checkState(id,url,shareLevel){		window.location.href = ctx+"/view/welfare/toFulidetail?wid="+id+"&adminId="+user.adminId; }function FormatDate (strTime) {    var date = new Date(strTime);    return date.getFullYear()+"-"+(date.getMonth()+1)+"-"+date.getDate();}function toback(){	window.history.go(-1);}function guanbi(){	$("#selectStyle").hide();}function showtips(obj) {	obj.show().delay(500).fadeOut();}function closekuangContent(){	$('.welfare_kuang').css('display', 'none');	$('.welfare_kuangBlack').css('display', 'none');}function showkuangContent(){	$('.welfare_kuangBlack').show();	$('.welfare_kuang').show();}   